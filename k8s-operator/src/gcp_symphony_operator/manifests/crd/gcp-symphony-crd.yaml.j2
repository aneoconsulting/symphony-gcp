# manifests/crds/example.com_myresources.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: "{{ crd_plural }}.{{ crd_group }}"
spec:
  group: "{{ crd_group }}"
  names:
    kind: "{{ crd_kind }}"
    listKind: "{{ crd_list }}List"
    plural: "{{ crd_plural }}"
    singular: "{{ crd_singular }}"
    shortNames:
      - {{ crd_short_name }}
  scope: Namespaced
  versions:
    - name: "{{ crd_api_version }}"
      served: true
      storage: true
      additionalPrinterColumns:
        - name: Status
          type: string
          description: Current Status
          jsonPath: .status.phase
        - name: MachinesRequested
          type: integer
          description: Number of Machines
          jsonPath: .spec.machineCount
        - name: MachinesAvailable
          type: integer
          description: Prefix for the pod names
          jsonPath: .status.availableMachines
        - name: Image
          type: string
          description: Container Image
          jsonPath: .spec.podSpec.containers[0].image
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                podSpec:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                  description: "Full Kubernetes PodSpec"
                machineCount:
                  type: integer
                  description: "Number of machines (pods) to provision"
                  minimum: 0
                  default: 1
                namePrefix:
                  type: string
                  description: "Prefix for the name of the machines (pods) to provision"
                labels:
                  type: object
                  description: "Labels to add to the machines (pods) to provision"
                  additionalProperties:
                    type: string
                annotations:
                  type: object
                  description: "Annotations to add to the machines (pods) to provision"
                  additionalProperties:
                    type: string
              required:
                - namePrefix
                - machineCount
                - podSpec
            status:
              type: object
              properties:
                phase:
                  type: string
                  description: The phase of the custom resource
                availableMachines:
                  type: integer
                  description: The number of available Machines
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                returnedMachines:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: "Name of the returned machine (pod)"
                      returnRequestId:
                        type: string
                        description: "RequestId that was submitted to delete this machine (pod)"
                      returnTime:
                        type: string
                        format: date-time
                        description: "Time when the machine (pod) was returnedd"
                  description: "When pod (machine) is returned, it gets put on this list by the operator for tracking."
                machines:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      phase:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                      hostIP:
                        type: string
                      podIP:
                        type: string
                      sequenceTime:
                        type: number
                        format: float
                      deleteRequestId:
                        type: string
                        description: "RequestId that was submitted to delete this machine (pod)"
              x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
