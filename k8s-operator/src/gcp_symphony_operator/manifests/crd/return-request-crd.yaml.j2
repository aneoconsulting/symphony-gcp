apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: "{{ pdr_plural }}.{{ crd_group }}"
spec:
  group: "{{ crd_group }}"
  names:
    kind: "{{ pdr_kind }}"
    listKind: "{{ pdr_kind }}List"
    plural: "{{ pdr_plural }}"
    singular: "{{ pdr_singular }}"
    shortNames:
      - mrr
      - {{ pdr_short_name }}
  scope: Namespaced
  versions:
    - name: "{{ crd_api_version }}"
      served: true
      storage: true
      additionalPrinterColumns:
        - name: Status
          type: string
          description: Current Status
          jsonPath: .status.phase
        - name: Machines
          type: integer
          description: Number of Machines to Return
          jsonPath: .status.totalMachines
        - name: Returned
          type: integer
          description: Number of Machines Returned
          jsonPath: .status.returnedMachines
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                requestId:
                  type: string
                  description: "Unique ID generated by the client application for tracking this return request"
                machineIds:
                  type: array
                  description: "List of machine IDs (pod names) to delete from a GCPSymphonyResource"
                  items:
                    type: string
                labels:
                  type: object
                  description: "Labels to add to the return request for filtering or categorization"
                  additionalProperties:
                    type: string
              required:
                - requestId
                - machineIds
            status:
              type: object
              properties:
                phase:
                  type: string
                  description: "The phase of the return request (Pending, InProgress, Completed, Failed)"
                totalMachines:
                  type: integer
                  description: "Total number of machines to return"
                returneddMachines:
                  type: integer
                  description: "Number of machines successfully returned"
                failedMachines:
                  type: integer
                  description: "Number of machines that failed to return"
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                machineEvents:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      machineId:
                        type: string
                        description: "ID of the machine (pod name)"
                      returnRequestTime:
                        type: string
                        format: date-time
                        description: "Time when the return request was initiated for this machine"
                      returnCompletionTime:
                        type: string
                        format: date-time
                        description: "Time when the machine was successfully returned"
                      status:
                        type: string
                        description: "Current status of the return operation for this machine (Pending, InProgress, Completed, Failed)"
                      message:
                        type: string
                        description: "Additional information about the return operation"
              x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
